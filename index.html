<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/GANRDEN010.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/GANRDEN010.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/GANRDEN010.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/GANRDEN010.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/GANRDEN010.github.io/css/main.css">


<link rel="stylesheet" href="/GANRDEN010.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"garden010.github.io","root":"/GANRDEN010.github.io/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Garden">
<meta property="og:url" content="https://garden010.github.io/GANRDEN010.github.io/index.html">
<meta property="og:site_name" content="Garden">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Garden">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://garden010.github.io/GANRDEN010.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Garden</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/GANRDEN010.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Garden</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">须知少时凌云志，曾许人间第一流</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/GANRDEN010.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/GANRDEN010.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/08/22/20220822-uds/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/08/22/20220822-uds/" class="post-title-link" itemprop="url">20220822-uds</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-08-22 17:28:11 / 修改时间：17:28:12" itemprop="dateCreated datePublished" datetime="2022-08-22T17:28:11+08:00">2022-08-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/08/14/20220814-CAN02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/08/14/20220814-CAN02/" class="post-title-link" itemprop="url">【车载网络学习-02】 CAN数据帧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-14 15:56:30" itemprop="dateCreated datePublished" datetime="2022-08-14T15:56:30+08:00">2022-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-17 22:18:02" itemprop="dateModified" datetime="2022-08-17T22:18:02+08:00">2022-08-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、报文发送两个机制"><a href="#一、报文发送两个机制" class="headerlink" title="一、报文发送两个机制"></a>一、报文发送两个机制</h3><h5 id="1-1-回读机制"><a href="#1-1-回读机制" class="headerlink" title="1.1 回读机制"></a>1.1 回读机制</h5><ul>
<li><p>侦测到总线空闲才发送；</p>
</li>
<li><p>ECU节点总是在回读总线上数据（一是确认发没发错，二是如果探测到总线上不是自己发的就把自己从发送状态改成接收状态）</p>
</li>
</ul>



<h5 id="1-2-线与机制"><a href="#1-2-线与机制" class="headerlink" title="1.2 线与机制"></a>1.2 线与机制</h5><ul>
<li><p>ID进行仲裁，数值越小优先级越高（因为0是显性，可以覆盖1，所以高位0越多优先级越高，呈现出来就是数值越小优先级越高）</p>
</li>
<li><p>两节点同时访问总线，仲裁后一个发送一个等待，仲裁后无“抢占”机制（不像OS那种进程抢占），发一半不发了（发一半让夹断不合适…）</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/08/13/20220813-CAN01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/" class="post-title-link" itemprop="url">【车载网络学习-01】 CAN总线概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-13 21:39:19" itemprop="dateCreated datePublished" datetime="2022-08-13T21:39:19+08:00">2022-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-14 15:53:10" itemprop="dateModified" datetime="2022-08-14T15:53:10+08:00">2022-08-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、车载网络概述"><a href="#一、车载网络概述" class="headerlink" title="一、车载网络概述"></a>一、车载网络概述</h2><h3 id="1-1-车载网络起源及CAN诞生条件"><a href="#1-1-车载网络起源及CAN诞生条件" class="headerlink" title="1.1 车载网络起源及CAN诞生条件"></a>1.1 车载网络起源及CAN诞生条件</h3><ul>
<li>二十世纪九十年代前，传统汽车的电器系统中各个模块之间采用点对点的通信方式，造成了庞大的布线系统，加之汽车近年来电子化、智能化趋势，独立运行的ECU足以实现电子功能。但工程师们很快就意识到，ECU彼此协调工作可以极大地增强车辆功能。</li>
<li>最初，ECU之间数据交换是以传统方式实现的，即为每一个传输信号分配一个物理通信通道，既布线规模大，又造成了数据交换、节点协助困难，因此解决这一难题的方法是通过单个通信通道（总线）进行串行位数据交换。</li>
<li>CAN具有数据传输非常可靠的特点，可以满足应用领域的实时要求。</li>
</ul>
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/1.png" class title="image">
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/2.png" class title="image">
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/4.png" class title="image">

<h4 id="1-1-1-ECU"><a href="#1-1-1-ECU" class="headerlink" title="1.1.1 ECU"></a>1.1.1 ECU</h4><p>ECU(electronic control unit)电子控制单元，简单理解就是汽车里控制某个具体功能的模块。常见的ECU比如：ABS（防抱死系统）、EMS（引擎管理系统）、电子防盗系统、自动空调等。各个ECU直接通过车载网络进行通信。</p>
<h4 id="1-1-2-CAN总线概述"><a href="#1-1-2-CAN总线概述" class="headerlink" title="1.1.2 CAN总线概述"></a>1.1.2 CAN总线概述</h4><ul>
<li><p>CAN（controller area network）控制器局域网络，最初CAN总线由德国Bosch（博世）公司设计，现在世界上几乎所有汽车制造商都在使用。</p>
</li>
<li><p>CAN发展简史</p>
<ol>
<li>1983年，德国Bosch公司开发设计了CAN总线协议。</li>
<li>1987年，第一块CAN控制器芯片有Intel设计成功。</li>
<li>1991年，CAN2.0发布（A标准格式+B扩展格式,标准CAN 主要发布扩展帧来解决标准帧仲裁ID位数不够的问题）</li>
<li>1993年，CAN成为ISO标准，分ISO 11898高速应用和ISO 11519低速应用。</li>
<li>2012-2015年，CAN-FD发布。</li>
</ol>
</li>
</ul>
<h2 id="二、CAN标准"><a href="#二、CAN标准" class="headerlink" title="二、CAN标准"></a>二、CAN标准</h2><p>CAN协议仅包括数据链路层和物理层。从下往上：</p>
<ol>
<li>CIA DS-102规定了CAN总线接头（推荐sub-D9，未强制使用）</li>
<li>ISO 11898-3、ISO 11898-2区别于低速/高速CAN，对速率有要求。高速（如电机等）用ISO 11898-2（最高1M/S）；低速（如雨刮等）用ISO 11898-3（125k/s）。</li>
<li>ISO 11898-1对应controller控制器</li>
</ol>
<p>边界条件</p>
<ol>
<li>长度40米</li>
<li>速率最大1M/s</li>
<li>网络末端要有终端电阻（防止高频反射）</li>
<li>根据收发器负载能力挂载节点</li>
</ol>
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/5.png" class title="image">

<p>CAN网络示意图：<br>对应ISO11898协议去看</p>
<p>物理构成：</p>
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/9.png" class title="image">

<p>host主机（人控制的部分）——CAN控制器——CAN收发器</p>
<p>控制器根据需要接收message。根据条件，有的需要携带对象存储器有的不需要（相当于收的信息多要加个内存，一般都有）。直接显示逻辑位（1/0）</p>
<p>收发器分为低速CAN和高速CAN收发器。收发器链接控制器和总线，如果总线上有很高的电平，只会破坏收发器而不会破坏到控制器（保护作用）</p>
<ul>
<li><p>低速CAN波特率0-125k/s，不需要终端电阻。看逻辑电平隐性1时是CAN_L比CAN_H要高5V,显性0时是CAN_H比CAN_L高2V左右。</p>
</li>
<li><p>高速CAN波特率0-1M/s，要接一个120Ω的终端电阻。看逻辑电平隐性1时是CAN_L和CAN_H相同都是2.5V，压差为0；显性0时是CAN_H比CAN_L高2V。</p>
</li>
<li><p>显性电平优先级高于隐性电平。当不同CAN节点同时发送显性和隐性总线电平时，CAN总线将呈现显性总线电平。只有当所有CAN节点都发送隐性电平时，CAN总线才呈现隐性总线电平。</p>
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/7.png" class title="image">
<img src="/GANRDEN010.github.io/2022/08/13/20220813-CAN01/8.png" class title="image"></li>
</ul>
<h3 id="三、CAN特性"><a href="#三、CAN特性" class="headerlink" title="三、CAN特性"></a>三、CAN特性</h3><h4 id="3-1-双线差分信号"><a href="#3-1-双线差分信号" class="headerlink" title="3.1 双线差分信号"></a>3.1 双线差分信号</h4><h4 id="3-2-协议本身对节点数量无限制，ID决定报文优先级"><a href="#3-2-协议本身对节点数量无限制，ID决定报文优先级" class="headerlink" title="3.2 协议本身对节点数量无限制，ID决定报文优先级"></a>3.2 协议本身对节点数量无限制，ID决定报文优先级</h4><p>多主方式工作，网络上任意一个节点均可以在任意时刻主动向网络上的其他节点发送信息，不分主从，方便灵活。广播式发送报文，各个节点可以同时接收。（为了保证报文正确性：发送前检测，发送中回读）</p>
<p>CAN中无“地址”概念，通过报文ID收发信息。广播——&gt;单播/组播</p>
<p>优先级由报文ID确定，ID越小优先级越高（高位0覆盖1）</p>
<h4 id="3-3-保证系统数据一致性"><a href="#3-3-保证系统数据一致性" class="headerlink" title="3.3 保证系统数据一致性"></a>3.3 保证系统数据一致性</h4><p>CAN提供了一套复杂的错误检测与错误处理机制，比如CRC检测、接口的抗电磁干扰能力、错误报文的自动重发、临时错误的恢复以及永久错误的关闭。</p>
<h4 id="3-4-编码方式：NRZ-位填充"><a href="#3-4-编码方式：NRZ-位填充" class="headerlink" title="3.4 编码方式：NRZ+位填充"></a>3.4 编码方式：NRZ+位填充</h4><p>NRZ(Non return zero)：不归零制，与曼彻斯特编码相比无跳变但是可携带更多信息，位填充解决了长时间无跳变易产生误差的问题。</p>
<p>位填充：五个相同电平跳变一次。（填充位置和帧结构有关，下节说明）</p>
<h4 id="3-5-CSMA-CA协议支持-很重要"><a href="#3-5-CSMA-CA协议支持-很重要" class="headerlink" title="3.5 CSMA/CA协议支持(很重要)"></a>3.5 CSMA/CA协议支持(很重要)</h4><h5 id="3-5-1-CSMA-CA协议发展"><a href="#3-5-1-CSMA-CA协议发展" class="headerlink" title="3.5.1 CSMA/CA协议发展"></a>3.5.1 CSMA/CA协议发展</h5><p>CSMA/CA，（Carrier Sense Multiple Access with Collision Avoid），即带有 冲突避免 的 载波侦听 多路访问。</p>
<p>是一种数据传输时避免各站点之间数据传输冲突的算法，其特点是发送包的同时不能检测到信道上有无冲突，只能尽量“避免”。</p>
<p>CS：载波侦听，发送前听信道上有无报文在发送，有的话就等待。</p>
<p>MA：多路访问，允许多个节点同时向总线收发信息。</p>
<p>CA：冲突避免，这里主要通过“非破坏性仲裁机制”完成，后一节讲帧结构会详细讲解。</p>
<ul>
<li><p>发展<br>纯ALOHA——时隙ALOHA——CSMA/CA</p>
<ol>
<li><p>纯ALOHA：发前不检测，长时间未收到确认帧认为信道有冲突，随机退避等待后重发，直至收到确认帧发送成功。问题：容易一直冲突，信道吞吐量低。</p>
</li>
<li><p>时隙ALOHA：把各个节点在时间上同步起来，并把时间化成一段段等长时隙slot，规定在每个时隙开始时才能发送报文（发送前先不确认是否有节点同时正在发送，所以先缓存一个周期时隙再发送）当发送碰撞时策略不变（随机退避）。理论上效率翻倍。</p>
</li>
<li><p>CSMA：相比就只多了个对信道的载波侦听装置，其余策略基本不变。</p>
</li>
</ol>
</li>
<li><p>三种CSMA</p>
<ol>
<li><p>1-坚持CSMA：信道空闲就发送，忙则一直等待但一直监听信道，冲突随机退避。（产生冲突可能性大）</p>
</li>
<li><p>非坚持CSMA：信道空闲就发送，忙则放弃，随机退避后再侦听信道。（降低冲突发送概率，但是会增加平均时延）</p>
</li>
<li><p>p-CSMA：如果信道空闲，会有P的概率发送报文，同时有（1-P）的概率在下一个时隙发送，如果下一个时隙信道仍然空闲，重复上述做法。（前两者的折中策略）</p>
</li>
</ol>
</li>
</ul>
<p>资料来源Vectoe官网：elearning.vector.com</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/06/03/20220603-diary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/06/03/20220603-diary/" class="post-title-link" itemprop="url">【学习日记】20220603</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-03 16:11:18 / 修改时间：16:39:26" itemprop="dateCreated datePublished" datetime="2022-06-03T16:11:18+08:00">2022-06-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="端午节快乐！"><a href="#端午节快乐！" class="headerlink" title="端午节快乐！"></a>端午节快乐！</h2><p>芜湖毕设拿下咯！小摆一天。开始准备华为od的笔试了，hr发了牛客题库，做一下吧。</p>
<h4 id="第一题：字符串最后一个单词长度"><a href="#第一题：字符串最后一个单词长度" class="headerlink" title="第一题：字符串最后一个单词长度"></a>第一题：字符串最后一个单词长度</h4><p>字符串.nextLine()方法拿到，charAt()定位，倒着打印直到空格就行。</p>
<h4 id="第二题：计算某字符出现次数"><a href="#第二题：计算某字符出现次数" class="headerlink" title="第二题：计算某字符出现次数"></a>第二题：计算某字符出现次数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：ABCabc       </span><br><span class="line">      A</span><br><span class="line">输出：2</span><br></pre></td></tr></table></figure>
<p>自己解法：暴力匹配，全部转大写或小写，匹配则count++，最后输出count。</p>
<p>引申：如果需要匹配的是字符串呢？</p>
<p>看到了高赞解法：将需要匹配的部分替换为空值，做减法。如果是字符串则除以字符串长度就能得出出现次数。哎呀没想到QAQ~</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Scanner scanner = new Scanner(System.in);</span><br><span class="line">String str1 = scanner.nextLine().toUpperCase();</span><br><span class="line">String str2 = scanner.nextLine().toUpperCase();</span><br><span class="line">System.out.print(str1.length()-str1.replaceAll(str2,&quot;&quot;).length());</span><br></pre></td></tr></table></figure>
<p>再引申：每次匹配到目标字符都从头开始，浪费时间，怎么节约时间？或者说不掉包手写要怎么办？——KMP！于是顺便复习下KMP算法。</p>
<h4 id="kmp算法"><a href="#kmp算法" class="headerlink" title="kmp算法"></a>kmp算法</h4><h5 id="1-暴力匹配"><a href="#1-暴力匹配" class="headerlink" title="1.暴力匹配"></a>1.暴力匹配</h5>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/06/03/20220603-Scanner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/06/03/20220603-Scanner/" class="post-title-link" itemprop="url">【复习日记】java中Scanner用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-03 15:10:01 / 修改时间：15:52:52" itemprop="dateCreated datePublished" datetime="2022-06-03T15:10:01+08:00">2022-06-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Scanner用法"><a href="#Scanner用法" class="headerlink" title="Scanner用法"></a>Scanner用法</h3><p>Scanner本质是一个扫描器，可用于读键盘输入、文件信息等。</p>
<p>当通过new Scanner(System.in)创建一个Scanner，控制台会一直等待输入，直到敲回车键结束，把所输入的内容传给Scanner，作为扫描对象。</p>
<h4 id="一、常用方法"><a href="#一、常用方法" class="headerlink" title="一、常用方法"></a>一、常用方法</h4><ul>
<li>next()：遇到空格或者换行符停止，返回String类型。</li>
<li>nextLine()；遇到换行符停止，返回String类型。</li>
<li>nextInt()，nextByte()，nextDouble()，nextFloat()，nextInt()，nextLong()，nextShot()等各种数据类型：这些方法可以读取对应的数据类型直到空格，并且只读对应的数据类型，输入其他类型的值会报InputMismatchException异常。</li>
<li>hasNext():判断扫描器中当前扫描位置后是否还存在下一段（空格分割）</li>
<li>hasNextLine()：判断扫描器中当前扫描位置后是否还存在下一行（换行符分割）</li>
</ul>
<h4 id="二、指定分隔符"><a href="#二、指定分隔符" class="headerlink" title="二、指定分隔符"></a>二、指定分隔符</h4><p>Scanner默认使用空格作为分割符来分隔文本，但useDelimiter()方法允许你指定新的分隔符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">        String s = &quot;我爱北京天安门，天安门上太阳升&quot;;</span><br><span class="line">        Scanner scanner = new Scanner(s);</span><br><span class="line">        scanner.useDelimiter(&quot;天安门&quot;);</span><br><span class="line">        while (scanner.hasNext())</span><br><span class="line">            System.out.println(scanner.next());</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">我爱北京</span><br><span class="line">，</span><br><span class="line">上太阳升</span><br></pre></td></tr></table></figure>
<p>delimiter()返回当前匹配分隔符的Pattern。</p>
<h4 id="三、输入字符"><a href="#三、输入字符" class="headerlink" title="三、输入字符"></a>三、输入字符</h4><p>不存在nextChar()方法，可以通过输入字符串转成字符数组。字符串通过charAt()定位。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        String str = &quot;abcdefg&quot;;</span><br><span class="line">        Scanner scanner = new Scanner(str);</span><br><span class="line">        char[] ch = new char[str.length()];</span><br><span class="line">        for(int i=0; i&lt;str.length(); i++) &#123;</span><br><span class="line">            //用charAt();进行定位分隔</span><br><span class="line">            ch[i] = str.charAt(i);</span><br><span class="line">            System.out.print(ch[i] + &quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ch.length);</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">a b c d e f g 7</span><br></pre></td></tr></table></figure>

<h4 id="四、用于检验输入：hasNextXXX"><a href="#四、用于检验输入：hasNextXXX" class="headerlink" title="四、用于检验输入：hasNextXXX()"></a>四、用于检验输入：hasNextXXX()</h4><p>例如：检验整数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Scanner  sc=new Scanner(System.in);</span><br><span class="line">int a=0;</span><br><span class="line">if(sc.hasNextInt())</span><br><span class="line">&#123;</span><br><span class="line">	a=sc.nextInt();	</span><br><span class="line">	System.out.println(a);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	System.out.println(&quot;输入的不是整数&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/05/12/20220512BS-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/05/12/20220512BS-05/" class="post-title-link" itemprop="url">毕设：基于机器学习的法律文书自动分类系统设计与实现__05分类功能实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-12 17:50:24 / 修改时间：21:02:16" itemprop="dateCreated datePublished" datetime="2022-05-12T17:50:24+08:00">2022-05-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>分类器在前面写过了，主要就是前后端交互</p>
<h3 id="一、flask前后端交互"><a href="#一、flask前后端交互" class="headerlink" title="一、flask前后端交互"></a>一、flask前后端交互</h3><ol>
<li>点击获取后台数据，前端不传值</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># html：</span><br><span class="line">&lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">    &lt;a href=&quot;&#123;&#123; url_for(&#x27;classify.nb&#x27;) &#125;&#125;&quot; class=&quot;btn btn-primary&quot; &gt;点击获取数据&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">    &lt;div style=&quot;padding-top: 60px&quot;&gt;预测结果：&#123;&#123; predict &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"># 蓝图文件：</span><br><span class="line">@bp.route(&quot;/nb&quot;)</span><br><span class="line">def nb():</span><br><span class="line">    # 省略操作得出predict的操作</span><br><span class="line">    predict = estimator.predict(x_test)</span><br><span class="line">    return render_template(&quot;classify.html&quot;, predict=predict)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>点击前端传递值过去，运算后传值回前端(post方法)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># html:</span><br><span class="line"> &lt;form action=&quot;&#123;&#123; url_for(&#x27;classify.nb2&#x27;) &#125;&#125;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;textarea type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;nb2&quot; rows=&quot;5&quot;&gt;这里输入数据&lt;/textarea&gt;</span><br><span class="line">    &lt;button class=&quot;btn btn-primary&quot;&gt;开始&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"> &lt;div id=&quot;display&quot; style=&quot;padding-top: 60px&quot;&gt;分类结果：&#123;&#123; predict &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 蓝图文件：</span><br><span class="line">@bp.route(&quot;/nb2&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def nb2():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;predict.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        content = request.form.get(&#x27;nb2&#x27;)</span><br><span class="line">        # 省略得出predict的操作</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        return render_template(&quot;predict.html&quot;, predict=predict)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>具体代码如下：classify.html:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"># Flask包中导入flask对象</span><br><span class="line"># render_template:渲染模板</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">from flask import Flask,render_template,request</span><br><span class="line"># 导入蓝图</span><br><span class="line">from flask import Blueprint</span><br><span class="line"># url_prefix视图前缀</span><br><span class="line">from sklearn.feature_extraction.text import TfidfVectorizer</span><br><span class="line">from sklearn.naive_bayes import MultinomialNB</span><br><span class="line">from sklearn.neighbors import KNeighborsClassifier</span><br><span class="line"></span><br><span class="line">from blueprints.forms import ClassifyForm</span><br><span class="line">from decorators import login_required</span><br><span class="line"></span><br><span class="line">from NLP_Modle.NaiveBayes import NaiveBayes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from NLP_Modle.Knn import Knn</span><br><span class="line"></span><br><span class="line">bp = Blueprint(&quot;classify&quot;,__name__,url_prefix=&quot;/classify&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 模型评估</span><br><span class="line">@bp.route(&quot;/classify&quot;)</span><br><span class="line"># 引入装饰器，设置用户的访问权限：每当要调用以下函数，要先执行装饰器里的函数</span><br><span class="line">@login_required</span><br><span class="line">def classify():</span><br><span class="line">    return render_template(&quot;classify.html&quot;)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/nb&quot;)</span><br><span class="line">def nb():</span><br><span class="line">    # NaiveBayes预测结果</span><br><span class="line">    with open(&#x27;NLP_Modle/X_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">    transfer = TfidfVectorizer()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">    estimator = MultinomialNB()</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    # 4.模型评估</span><br><span class="line">    predict = estimator.predict(x_test)</span><br><span class="line">    # 计算准确率</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line"></span><br><span class="line">    return render_template(&quot;classify.html&quot;, predict=predict, score=score, res=(y_test == predict))</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/knn&quot;)</span><br><span class="line">def knn():</span><br><span class="line">    # KNN预测结果</span><br><span class="line">    with open(&#x27;NLP_Modle/X_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">    transfer = TfidfVectorizer()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    # 3.KNN算法预估器流程</span><br><span class="line">    estimator = KNeighborsClassifier()</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    # 4.模型评估</span><br><span class="line">    predict = estimator.predict(x_test)</span><br><span class="line">    # 计算准确率</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line"></span><br><span class="line">    return render_template(&quot;classify.html&quot;, predict=predict, score=score, res=(y_test == predict))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/predict&quot;)</span><br><span class="line">@login_required</span><br><span class="line">def predict():</span><br><span class="line">    return render_template(&quot;predict.html&quot;)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/nb2&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def nb2():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;predict.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        content = request.form.get(&#x27;nb2&#x27;)</span><br><span class="line">        str = content</span><br><span class="line">        print(str)</span><br><span class="line">        data = [str]</span><br><span class="line"></span><br><span class="line">        # NaiveBayes预测结果</span><br><span class="line">        with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        x_test = data</span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">        transfer = TfidfVectorizer()</span><br><span class="line">        x_train = transfer.fit_transform(x_train)</span><br><span class="line">        # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">        x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">        # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">        estimator = MultinomialNB()</span><br><span class="line">        estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">        # 4.模型评估</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        predict1 = predict[0]</span><br><span class="line"></span><br><span class="line">        return render_template(&quot;predict.html&quot;, predict=predict1)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/knn2&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def knn2():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;predict.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        content = request.form.get(&#x27;knn2&#x27;)</span><br><span class="line">        str = content</span><br><span class="line">        print(str)</span><br><span class="line">        data = [str]</span><br><span class="line"></span><br><span class="line">        # NaiveBayes预测结果</span><br><span class="line">        with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        x_test = data</span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">        transfer = TfidfVectorizer()</span><br><span class="line">        x_train = transfer.fit_transform(x_train)</span><br><span class="line">        # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">        x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">        # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">        estimator = KNeighborsClassifier()</span><br><span class="line">        estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">        # 4.模型评估</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        predict1 = predict[0]</span><br><span class="line"></span><br><span class="line">        return render_template(&quot;predict.html&quot;, predict=predict1)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>predict.html：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;文本分类&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block head %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot; style=&quot;padding-top: 50px&quot;&gt;</span><br><span class="line">&lt;h3&gt;在下面的文本框里输入即将要预测的法律文书&lt;/h3&gt;</span><br><span class="line">  &lt;div class=&quot;row&quot; style=&quot;padding-top:30px&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;card&quot; style=&quot;width: 18rem;&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">    &lt;h5 class=&quot;card-title&quot;&gt;使用朴素贝叶斯分类&lt;/h5&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=&quot;&#123;&#123; url_for(&#x27;classify.nb2&#x27;) &#125;&#125;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;textarea type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;nb2&quot; rows=&quot;5&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;button class=&quot;btn btn-primary&quot;&gt;开始&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;</span><br><span class="line">       &lt;div class=&quot;card&quot; style=&quot;width: 18rem;&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">     &lt;h5 class=&quot;card-title&quot;&gt;使用KNN分类&lt;/h5&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=&quot;&#123;&#123; url_for(&#x27;classify.knn2&#x27;) &#125;&#125;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;textarea type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;knn2&quot; rows=&quot;5&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;button class=&quot;btn btn-primary&quot;&gt;开始&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    &lt;div id=&quot;display&quot; style=&quot;padding-top: 60px&quot;&gt;分类结果：&#123;&#123; predict &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>classify.py：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"># Flask包中导入flask对象</span><br><span class="line"># render_template:渲染模板</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">from flask import Flask,render_template,request</span><br><span class="line"># 导入蓝图</span><br><span class="line">from flask import Blueprint</span><br><span class="line"># url_prefix视图前缀</span><br><span class="line">from sklearn.feature_extraction.text import TfidfVectorizer</span><br><span class="line">from sklearn.naive_bayes import MultinomialNB</span><br><span class="line">from sklearn.neighbors import KNeighborsClassifier</span><br><span class="line"></span><br><span class="line">from blueprints.forms import ClassifyForm</span><br><span class="line">from decorators import login_required</span><br><span class="line"></span><br><span class="line">from NLP_Modle.NaiveBayes import NaiveBayes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from NLP_Modle.Knn import Knn</span><br><span class="line"></span><br><span class="line">bp = Blueprint(&quot;classify&quot;,__name__,url_prefix=&quot;/classify&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 模型评估</span><br><span class="line">@bp.route(&quot;/classify&quot;)</span><br><span class="line"># 引入装饰器，设置用户的访问权限：每当要调用以下函数，要先执行装饰器里的函数</span><br><span class="line">@login_required</span><br><span class="line">def classify():</span><br><span class="line">    return render_template(&quot;classify.html&quot;)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/nb&quot;)</span><br><span class="line">def nb():</span><br><span class="line">    # NaiveBayes预测结果</span><br><span class="line">    with open(&#x27;NLP_Modle/X_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">    transfer = TfidfVectorizer()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">    estimator = MultinomialNB()</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    # 4.模型评估</span><br><span class="line">    predict = estimator.predict(x_test)</span><br><span class="line">    # 计算准确率</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line"></span><br><span class="line">    return render_template(&quot;classify.html&quot;, predict=predict, score=score, res=(y_test == predict))</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/knn&quot;)</span><br><span class="line">def knn():</span><br><span class="line">    # KNN预测结果</span><br><span class="line">    with open(&#x27;NLP_Modle/X_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">    with open(&#x27;NLP_Modle/Y_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">        y_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">    transfer = TfidfVectorizer()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    # 3.KNN算法预估器流程</span><br><span class="line">    estimator = KNeighborsClassifier()</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    # 4.模型评估</span><br><span class="line">    predict = estimator.predict(x_test)</span><br><span class="line">    # 计算准确率</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line"></span><br><span class="line">    return render_template(&quot;classify.html&quot;, predict=predict, score=score, res=(y_test == predict))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/predict&quot;)</span><br><span class="line">@login_required</span><br><span class="line">def predict():</span><br><span class="line">    return render_template(&quot;predict.html&quot;)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/nb2&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def nb2():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;predict.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        content = request.form.get(&#x27;nb2&#x27;)</span><br><span class="line">        str = content</span><br><span class="line">        print(str)</span><br><span class="line">        data = [str]</span><br><span class="line"></span><br><span class="line">        # NaiveBayes预测结果</span><br><span class="line">        with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        x_test = data</span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">        transfer = TfidfVectorizer()</span><br><span class="line">        x_train = transfer.fit_transform(x_train)</span><br><span class="line">        # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">        x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">        # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">        estimator = MultinomialNB()</span><br><span class="line">        estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">        # 4.模型评估</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        predict1 = predict[0]</span><br><span class="line"></span><br><span class="line">        return render_template(&quot;predict.html&quot;, predict=predict1)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/knn2&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def knn2():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;predict.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        content = request.form.get(&#x27;knn2&#x27;)</span><br><span class="line">        str = content</span><br><span class="line">        print(str)</span><br><span class="line">        data = [str]</span><br><span class="line"></span><br><span class="line">        # NaiveBayes预测结果</span><br><span class="line">        with open(&#x27;NLP_Modle/Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;NLP_Modle/X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        x_test = data</span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">        transfer = TfidfVectorizer()</span><br><span class="line">        x_train = transfer.fit_transform(x_train)</span><br><span class="line">        # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">        x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">        # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">        estimator = KNeighborsClassifier()</span><br><span class="line">        estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">        # 4.模型评估</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        predict1 = predict[0]</span><br><span class="line"></span><br><span class="line">        return render_template(&quot;predict.html&quot;, predict=predict1)</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<img src="/GANRDEN010.github.io/2022/05/12/20220512BS-05/1.png" class title="1.png">


<img src="/GANRDEN010.github.io/2022/05/12/20220512BS-05/2.png" class title="2.png">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/05/11/20220511BS-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/05/11/20220511BS-04/" class="post-title-link" itemprop="url">毕设：基于机器学习的法律文书自动分类系统设计与实现__04登录注册模块</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-11 00:16:20" itemprop="dateCreated datePublished" datetime="2022-05-11T00:16:20+08:00">2022-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-12 21:02:10" itemprop="dateModified" datetime="2022-05-12T21:02:10+08:00">2022-05-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、写个base父模板"><a href="#一、写个base父模板" class="headerlink" title="一、写个base父模板"></a>一、写个base父模板</h3><p>‘#’处还未规定跳转页面，根据需求更改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125;&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;bootstrap5/bootstrap.min.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;bootstrap5/font/bootstrap-icons.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="line">    &#123;#要保证jQuery在前面，否则轮播图这里会报错#&#125;</span><br><span class="line">    &lt;script src=&quot;static/jquery/jQuery.3.6.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;static/bootstrap5/font/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &#123;% block head  %&#125;&#123;% endblock %&#125;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=&quot;background-color: #eef4f8&quot;&gt;</span><br><span class="line">&#123;#容器方便布局，而且最小化后也不会乱；容器分12份，col-x就代表这个方块占了x份#&#125;</span><br><span class="line"></span><br><span class="line">&#123;#这里是header#&#125;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;</span><br><span class="line">      &lt;nav class=&quot;navbar navbar-expand-lg &quot; style=&quot;height: 80px;background-color: #5f626c&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;container-fluid&quot;&gt;</span><br><span class="line">    &lt;a class=&quot;navbar-brand text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px&quot;&gt;法律文书自动分类系统&lt;/a&gt;</span><br><span class="line">    &lt;form class=&quot;d-flex&quot; role=&quot;search&quot;&gt;</span><br><span class="line">        &lt;input class=&quot;form-control me-2&quot; type=&quot;search&quot; placeholder=&quot;Search&quot; aria-label=&quot;Search&quot; style=&quot;width: 500px&quot;&gt;</span><br><span class="line">        &lt;button class=&quot;btn btn-outline-success text-white&quot; type=&quot;submit&quot;&gt;&lt;i class=&quot;bi bi-search&quot;&gt;&lt;/i&gt;  Search&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">      &lt;div class=&quot;navbar-nav&quot; style=&quot;margin-right: 50px&quot;&gt;</span><br><span class="line">        &lt;i class=&quot;bi bi-person&quot; style=&quot;font-size: 25px;color: white&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">        &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; &gt;注册&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot; &gt;</span><br><span class="line">&lt;div class=&quot;row&quot; style=&quot;height: 600px&quot; &gt;</span><br><span class="line">&#123;#这里是侧边栏#&#125;</span><br><span class="line">&lt;div class=&quot;col-2&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;ul class=&quot;navbar-nav&quot; style=&quot;background-color: #5f626c;height: 100%&quot;&gt;</span><br><span class="line">    &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px;margin-top: 20px&quot;&gt;&lt;i class=&quot;bi bi-bank&quot;&gt;&lt;/i&gt;  首页&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px;margin-top: 20px&quot;&gt;&lt;i class=&quot;bi bi-palette2&quot;&gt;&lt;/i&gt;  模型展示&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px;margin-top: 20px&quot;&gt;&lt;i class=&quot;bi bi-files&quot;&gt;&lt;/i&gt;  文本分类&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px;margin-top: 20px&quot;&gt;&lt;i class=&quot;bi bi-stickies&quot;&gt;&lt;/i&gt;  可视化展示&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot; style=&quot;margin-left: 50px;margin-top: 20px;margin-bottom: 20px&quot;&gt;&lt;i class=&quot;bi bi-folder&quot;&gt;&lt;/i&gt;  数据库浏览&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;#这里是main任务栏，子模板会完成该部分#&#125;</span><br><span class="line">&lt;div class=&quot;col&quot;&gt;</span><br><span class="line">  &#123;% block body %&#125;&#123;% endblock %&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&#123;#这里是footer#&#125;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;a href=&quot;#&quot;&gt;#机器学习&lt;/a&gt; |</span><br><span class="line">    &lt;a href=&quot;#&quot;&gt;#文本分类&lt;/a&gt; |</span><br><span class="line">    &lt;a href=&quot;#&quot;&gt;#bootstrap5中文文档&lt;/a&gt; |</span><br><span class="line">    &lt;a href=&quot;#&quot;&gt;#flask&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="二、子模板基础，以首页为例，其他页面相同"><a href="#二、子模板基础，以首页为例，其他页面相同" class="headerlink" title="二、子模板基础，以首页为例，其他页面相同"></a>二、子模板基础，以首页为例，其他页面相同</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;首页&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">&#123;#  轮播图#&#125;</span><br><span class="line">&lt;div id=&quot;carouselExampleIndicators&quot; class=&quot;carousel slide&quot; data-bs-ride=&quot;carousel&quot; style=&quot;padding-right:30px;padding-top: 10px&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;carousel-indicators&quot; &gt;</span><br><span class="line">    &lt;button type=&quot;button&quot; data-bs-target=&quot;#carouselExampleIndicators&quot; data-bs-slide-to=&quot;0&quot; class=&quot;active&quot; aria-current=&quot;true&quot; aria-label=&quot;Slide 1&quot;&gt;&lt;/button&gt;</span><br><span class="line">    &lt;button type=&quot;button&quot; data-bs-target=&quot;#carouselExampleIndicators&quot; data-bs-slide-to=&quot;1&quot; aria-label=&quot;Slide 2&quot;&gt;&lt;/button&gt;</span><br><span class="line">    &lt;button type=&quot;button&quot; data-bs-target=&quot;#carouselExampleIndicators&quot; data-bs-slide-to=&quot;2&quot; aria-label=&quot;Slide 3&quot;&gt;&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;carousel-inner&quot; style=&quot;height: 200px&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;carousel-item active&quot;&gt;</span><br><span class="line">      &lt;img src=&quot;static/img/1.png&quot; class=&quot;d-block w-100&quot; &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;carousel-item&quot;&gt;</span><br><span class="line">      &lt;img src=&quot;static/img/2.png&quot; class=&quot;d-block w-100&quot; alt=&quot;...&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;carousel-item&quot;&gt;</span><br><span class="line">      &lt;img src=&quot;static/img/3.png&quot; class=&quot;d-block w-100&quot; alt=&quot;...&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button class=&quot;carousel-control-prev&quot; type=&quot;button&quot; data-bs-target=&quot;#carouselExampleIndicators&quot; data-bs-slide=&quot;prev&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;carousel-control-prev-icon&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;span class=&quot;visually-hidden&quot;&gt;Previous&lt;/span&gt;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">  &lt;button class=&quot;carousel-control-next&quot; type=&quot;button&quot; data-bs-target=&quot;#carouselExampleIndicators&quot; data-bs-slide=&quot;next&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;carousel-control-next-icon&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;span class=&quot;visually-hidden&quot;&gt;Next&lt;/span&gt;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;#关于#&#125;</span><br><span class="line">&lt;div class=&quot;row&quot; style=&quot;padding-left: 30px&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;li style=&quot;margin-top: 20px&quot;&gt;本课题的研究方向是设计并实现一套能够对用户输入的法律文书进行分类的系统，从而节约人力成本，提高分类效率。文书数据参考中国裁判文书网，将文书分为三类：民事案件、刑事案件、行政案件。本论文将会运用朴素贝叶斯的思想，将用户输入的文本进行分类。&lt;/li&gt;</span><br><span class="line">    &lt;li style=&quot;margin-top: 20px&quot;&gt;在使用分类功能前，请先注册/登录&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="路由注册"><a href="#路由注册" class="headerlink" title="路由注册"></a>路由注册</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Flask包中导入flask对象</span><br><span class="line"># render_template:渲染模板</span><br><span class="line">from flask import Flask,render_template</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用Flask创建一个app对象,并传递__name__参数，是固定的</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"># 路由，设置访问的URL，这里是设置一个根路径，当访问根路径的时候就会执行这个hello_world()函数</span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def hello_world():  # put application&#x27;s code here</span><br><span class="line">    return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line"># url必须以/开头，否则会报错（ValueError: urls must start with a leading slash）</span><br><span class="line">@app.route(&quot;/index&quot;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/1.png" class title="1.png">


<h3 id="二、登录注册功能"><a href="#二、登录注册功能" class="headerlink" title="二、登录注册功能"></a>二、登录注册功能</h3><h4 id="1-新建register-html和login-html，继承父模板"><a href="#1-新建register-html和login-html，继承父模板" class="headerlink" title="1.新建register.html和login.html，继承父模板"></a>1.新建register.html和login.html，继承父模板</h4><h4 id="2-项目目录下新建blueprints文件夹，里面再创建user-py，用于注册路由以及写方法。（同时把app-py也搬进去）-首页和分类功能写在classify-py中"><a href="#2-项目目录下新建blueprints文件夹，里面再创建user-py，用于注册路由以及写方法。（同时把app-py也搬进去）-首页和分类功能写在classify-py中" class="headerlink" title="2.项目目录下新建blueprints文件夹，里面再创建user.py，用于注册路由以及写方法。（同时把app.py也搬进去）,首页和分类功能写在classify.py中"></a>2.项目目录下新建blueprints文件夹，里面再创建user.py，用于注册路由以及写方法。（同时把app.py也搬进去）,首页和分类功能写在classify.py中</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># user.py:</span><br><span class="line"></span><br><span class="line"> # Flask包中导入flask对象</span><br><span class="line">from flask import (</span><br><span class="line">    Blueprint,  # 导入蓝图</span><br><span class="line">    render_template,  # render_template:渲染模板</span><br><span class="line">    request,</span><br><span class="line">    redirect,</span><br><span class="line">    url_for,</span><br><span class="line">    jsonify,</span><br><span class="line">    session,</span><br><span class="line">    flash</span><br><span class="line">)</span><br><span class="line"># url_prefix视图前缀</span><br><span class="line">bp = Blueprint(&quot;user&quot;,__name__,url_prefix=&quot;/user&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/login&quot;)</span><br><span class="line">def login():</span><br><span class="line">    return render_template(&quot;login.html&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/register&quot;)</span><br><span class="line">def login():</span><br><span class="line">    return render_template(&quot;register.html&quot;)</span><br><span class="line"></span><br><span class="line"># classify.py:</span><br><span class="line"># Flask包中导入flask对象</span><br><span class="line"># render_template:渲染模板</span><br><span class="line">from flask import Flask,render_template</span><br><span class="line"># 导入蓝图</span><br><span class="line">from flask import Blueprint</span><br><span class="line"># url_prefix视图前缀</span><br><span class="line">bp = Blueprint(&quot;classify&quot;,__name__,url_prefix=&quot;/&quot;)</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/&quot;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line"># init.py:</span><br><span class="line">from .user import bp as user_bp</span><br><span class="line">from .classify import bp as classify_bp</span><br></pre></td></tr></table></figure>
<p>此时的app.py:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Flask包中导入flask对象</span><br><span class="line"># render_template:渲染模板</span><br><span class="line">from flask import Flask,render_template</span><br><span class="line">import config</span><br><span class="line">from exts import db</span><br><span class="line">from blueprints import user_bp,classify_bp</span><br><span class="line"></span><br><span class="line"># 使用Flask创建一个app对象,并传递__name__参数，是固定的</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"># 绑定config</span><br><span class="line">app.config.from_object(config)</span><br><span class="line">db.init_app(app)</span><br><span class="line"># 注册蓝图信息</span><br><span class="line">app.register_blueprint(user_bp)</span><br><span class="line">app.register_blueprint(classify_bp)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-完善登录注册的html页面"><a href="#3-完善登录注册的html页面" class="headerlink" title="3.完善登录注册的html页面"></a>3.完善登录注册的html页面</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#login.html:</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;法律文书分类系统 - 登录&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block head %&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line"></span><br><span class="line">  &lt;div class=&quot;row mt-5&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;</span><br><span class="line">      &lt;form action=&quot;&#123;&#123; url_for(&quot;user.login&quot;) &#125;&#125;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">      &lt;label for=&quot;exampleInputEmail1&quot; class=&quot;form-label&quot;&gt;邮箱&lt;/label&gt;</span><br><span class="line">      &lt;input type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;exampleInputEmail1&quot; aria-describedby=&quot;emailHelp&quot; name=&quot;email&quot;&gt;</span><br><span class="line">      &lt;div id=&quot;emailHelp&quot; class=&quot;form-text&quot;&gt;We&#x27;ll never share your information with anyone else.&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">      &lt;label for=&quot;exampleInputPassword1&quot; class=&quot;form-label&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">      &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; name=&quot;password&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &#123;% for massage in get_flashed_messages() %&#125;</span><br><span class="line">        &lt;div class=&quot;from-group&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;text-danger&quot;&gt;&#123;&#123; massage &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;from-group&quot;&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-sm&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"># register.html:</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;法律文书分类系统 - 注册&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">  &lt;div class=&quot;row mt-5&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;</span><br><span class="line">      &lt;form action=&quot;&#123;&#123; url_for(&quot;user.login&quot;) &#125;&#125;&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">      &lt;label for=&quot;exampleInputEmail1&quot; class=&quot;form-label&quot;&gt;邮箱&lt;/label&gt;</span><br><span class="line">      &lt;input type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;exampleInputEmail1&quot; aria-describedby=&quot;emailHelp&quot; name=&quot;email&quot;&gt;</span><br><span class="line">      &lt;div id=&quot;emailHelp&quot; class=&quot;form-text&quot;&gt;We&#x27;ll never share your information with anyone else.&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">      &lt;label for=&quot;exampleInputPassword1&quot; class=&quot;form-label&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">      &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; name=&quot;password&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &#123;% for massage in get_flashed_messages() %&#125;</span><br><span class="line">        &lt;div class=&quot;from-group&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;text-danger&quot;&gt;&#123;&#123; massage &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;from-group&quot;&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-sm&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;col&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/2.png" class title="2.png">
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/3.png" class title="3.png">

<h4 id="4-flask发送邮件"><a href="#4-flask发送邮件" class="headerlink" title="4.flask发送邮件"></a>4.flask发送邮件</h4><ol>
<li>安装flask-mail</li>
</ol>
<p>pip install flask-mail</p>
<ol start="2">
<li>配置邮箱，config.py(这里用的qq邮箱)<br>打开qq邮箱-设置-账户-POP3/IMAP…-开启POP3/SMTP服务，然后qq密保手机验证即可。他会给你一个授权码，写在下面的MAIL_PASSWORD中。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 邮箱配置</span><br><span class="line">MAIL_SERVER = &quot;smtp.qq.com&quot;     # 固定写法</span><br><span class="line">MAIL_PORT = 465                 # 固定写法</span><br><span class="line">MAIL_USE_TLS = False            # 固定写法</span><br><span class="line">MAIL_USE_SSL = True             # 固定写法</span><br><span class="line">MAIL_DEBUG = True               # 固定写法</span><br><span class="line">MAIL_USERNAME = &quot;xxxx@qq.com&quot;</span><br><span class="line">MAIL_PASSWORD = &quot;xxxxxxxxxx&quot;</span><br><span class="line">MAIL_DEFAULT_SENDER = &quot;xxxx@qq.com&quot;</span><br></pre></td></tr></table></figure>
设置完毕后这个qq邮箱就可以给别的邮箱发邮件了</li>
</ol>
<p>exts.py:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from flask_sqlalchemy import SQLAlchemy</span><br><span class="line">from flask_mail import Mail</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line">mail = Mail()</span><br></pre></td></tr></table></figure>
<p>app.py中追加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from exts import db,mail</span><br><span class="line">mail.init_app(app)</span><br></pre></td></tr></table></figure>
<p>测试：<br>在user.py中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Message是邮件发送的信息</span><br><span class="line">from flask_mail import Message</span><br><span class="line"></span><br><span class="line">@bp.route(&quot;/mail&quot;)</span><br><span class="line">def my_mail():</span><br><span class="line">    message = Message(</span><br><span class="line">        subject=&quot;邮箱测试&quot;,  #主题</span><br><span class="line">        recipients=[&#x27;xxx@163.com&#x27;],   #收邮件的邮箱</span><br><span class="line">        body=&quot;这是一篇测试邮箱&quot;   # 邮件主题</span><br><span class="line">    )</span><br><span class="line">    mail.send(message)</span><br><span class="line">    return &quot;success&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>测试结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/4.png" class title="4.png">


<h4 id="5-邮箱验证码"><a href="#5-邮箱验证码" class="headerlink" title="5.邮箱验证码"></a>5.邮箱验证码</h4><ol>
<li><p>链接数据库</p>
<blockquote>
<p>SQLAlchemy:是一个独立的ORM框架，可以独立flask存在<br>Flask-SQLAlchemy:对SQLAlchemy的一个封装，更适合在flask里使用</p>
</blockquote>
</li>
<li><p>安装</p>
</li>
</ol>
<p>pip install pymysql</p>
<p>pip install SQLAlchemy</p>
<ol start="3">
<li><p>链接数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># config.py</span><br><span class="line"></span><br><span class="line"># 数据库配置</span><br><span class="line">HOSTNAME = &#x27;127.0.0.1&#x27;</span><br><span class="line">PORT = &#x27;3306&#x27;</span><br><span class="line">DATABASE = &#x27;finalBS_flask&#x27;</span><br><span class="line">USERNAME = &#x27;root&#x27;</span><br><span class="line">PASSWORD = &#x27;123456&#x27;</span><br><span class="line">DB_URI = &#x27;mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8&#x27;.format(USERNAME,PASSWORD,HOSTNAME,PORT,DATABASE)</span><br><span class="line">SQLALCHEMY_DATABASE_URI = DB_URI</span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = True</span><br></pre></td></tr></table></figure></li>
<li><p>新建models.py，创建模型（数据库表）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from exts import  db</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line"># 创建数据库表（模型)</span><br><span class="line">class EmailCaptchaModel(db.Model):</span><br><span class="line">    __tablename__ = &quot;email_captcha&quot;</span><br><span class="line">    id = db.Column(db.Integer,primary_key=True,autoincrement=True)</span><br><span class="line">    email = db.Column(db.String(100),nullable=False,unique=True)</span><br><span class="line">    captcha = db.Column(db.String(10),nullable=False)</span><br><span class="line">    create_time = db.Column(db.DateTime,default=datetime.now)</span><br></pre></td></tr></table></figure></li>
<li><p>数据库表迁移</p>
</li>
</ol>
<p>终端依次输入：</p>
<p>flask db init</p>
<p>flask db migrate</p>
<p>flask db upgrade</p>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/5.png" class title="5.png">

<ol start="6">
<li><p>get测试是否能生成随机验证码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#user.py中：</span><br><span class="line"></span><br><span class="line">import string</span><br><span class="line">import random</span><br><span class="line">@bp.route(&quot;/captcha&quot;)</span><br><span class="line">def get_captcha():</span><br><span class="line">    # 生成验证码</span><br><span class="line">    letters = string.ascii_letters + string.digits</span><br><span class="line">    captcha = &quot;&quot;.join(random.sample(letters,4))</span><br><span class="line">    #获取邮箱</span><br><span class="line">    email = request.args.get(&quot;email&quot;)</span><br><span class="line">    if email:</span><br><span class="line">        message = Message(</span><br><span class="line">            subject=&quot;邮箱验证码&quot;,</span><br><span class="line">            recipients=[email],</span><br><span class="line">            body=f&quot;您的注册码是：&#123;captcha&#125;,请不要告诉任何人！&quot;,</span><br><span class="line">        )</span><br><span class="line">        mail.send(message)</span><br><span class="line">        return &quot;success&quot;</span><br><span class="line">    else:</span><br><span class="line">        return &quot;无对象&quot;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/6.png" class title="6.png"></li>
<li><p>把邮箱和验证码都存在数据库中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def get_captcha():</span><br><span class="line">    # 生成验证码</span><br><span class="line">    letters = string.ascii_letters + string.digits</span><br><span class="line">    captcha = &quot;&quot;.join(random.sample(letters,4))</span><br><span class="line">    #获取邮箱</span><br><span class="line">    email = request.args.get(&quot;email&quot;)</span><br><span class="line">    if email:</span><br><span class="line">        message = Message(</span><br><span class="line">            subject=&quot;邮箱验证码&quot;,</span><br><span class="line">            recipients=[email],</span><br><span class="line">            body=f&quot;您的注册码是：&#123;captcha&#125;,请不要告诉任何人！&quot;,</span><br><span class="line">        )</span><br><span class="line">        mail.send(message)</span><br><span class="line">        # 检查验证码在数据库中是否已存在,存在直接更新验证码，不存在才添加数据条目</span><br><span class="line">        captcha_model = EmailCaptchaModel.query.filter_by(email=email).first()</span><br><span class="line">        if captcha_model:</span><br><span class="line">            # 存在就去修改验证码，时间更改为当前时间（model里那个default只会在第一次保存数据库时生效，所以不用担心datatime相互覆盖）</span><br><span class="line">            captcha_model.captcha = captcha</span><br><span class="line">            captcha_model.create_time = datetime.now()</span><br><span class="line">            db.session.commit()</span><br><span class="line">        else:</span><br><span class="line">            captcha_model = EmailCaptchaModel(email=email, captcha=captcha)</span><br><span class="line">            db.session.add(captcha_model)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            print(&quot;captcha&quot;, captcha)</span><br><span class="line">        return &quot;success&quot;</span><br><span class="line">    else:</span><br><span class="line">        return &quot;无对象&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/7.png" class title="7.png">

<h4 id="6-实现注册功能"><a href="#6-实现注册功能" class="headerlink" title="6.实现注册功能"></a>6.实现注册功能</h4><ol>
<li>新建用户模型</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># model里：</span><br><span class="line">class UserModel(db.Model):</span><br><span class="line">    __tablename__ = &quot;user&quot;</span><br><span class="line">    id = db.Column(db.Integer, primary_key=True, autoincrement=True)</span><br><span class="line">    username = db.Column(db.String(200), nullable=False, unique=True)</span><br><span class="line">    email = db.Column(db.String(100), nullable=False, unique=True)</span><br><span class="line">    # 位数多一点，便于加密</span><br><span class="line">    password = db.Column(db.String(200), nullable=False)</span><br><span class="line">    join_time = db.Column(db.DateTime, default=datetime.now)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>migrate同步到数据库</li>
</ol>
<p>flask db migrate</p>
<p>flask db upgrade</p>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/8.png" class title="8.png">

<ol start="3">
<li>注册功能</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@bp.route(&quot;/register&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def register():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;register.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        # 验证表单信息</span><br><span class="line">        form = RegisterForm(request.form)</span><br><span class="line">        if form.validate():</span><br><span class="line">            email = form.email.data</span><br><span class="line">            username = form.username.data</span><br><span class="line">            password = form.password.data</span><br><span class="line"></span><br><span class="line">            #md5(hash)，用于加密，在数据库中也无法看到密码是多少</span><br><span class="line">            hash_password = generate_password_hash(password)</span><br><span class="line">            user = UserModel(email=email, username=username, password=hash_password)</span><br><span class="line">            db.session.add(user)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            # 注册成果返回登录页面，失败返回注册页</span><br><span class="line">            return redirect(url_for(&quot;user.login&quot;))</span><br><span class="line">        else:</span><br><span class="line">            return redirect(url_for(&quot;user.register&quot;))</span><br><span class="line"></span><br><span class="line"># forms验证：</span><br><span class="line">class RegisterForm(wtforms.Form):</span><br><span class="line">    # validators验证器</span><br><span class="line">    username = wtforms.StringField(validators=[length(min=1,max=20)])</span><br><span class="line">    email = wtforms.StringField(validators=[email()])</span><br><span class="line">    captcha = wtforms.StringField(validators=[length(min=4,max=4)])</span><br><span class="line">    password = wtforms.StringField(validators=[length(min=6,max=20)])</span><br><span class="line">    password_confirm = wtforms.StringField(validators=[EqualTo(&quot;password&quot;)])</span><br><span class="line"></span><br><span class="line">    # validate_xxx:去具体验证某一项</span><br><span class="line">    def validate_captcha(self,field):</span><br><span class="line">        captcha = field.data</span><br><span class="line">        email = self.email.data</span><br><span class="line">        captcha_model = EmailCaptchaModel.query.filter_by(email=email).first()</span><br><span class="line">        if not captcha_model or captcha_model.captcha.lower() != captcha.lower():</span><br><span class="line">            raise wtforms.ValidationError(&quot;邮箱验证码错误！&quot;)</span><br><span class="line"></span><br><span class="line">    def validate_email(self,field):</span><br><span class="line">        email = field.data</span><br><span class="line">        user_model = UserModel.query.filter_by(email=email).first()</span><br><span class="line">        if user_model:</span><br><span class="line">            raise wtforms.ValidationError(&quot;邮箱已注册&quot;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>写个发送验证码的js，同时把计时器搞上</li>
</ol>
<p>因为是post，所以记得把user.py里的get_captcha()也要改成post提交，否则汇报405</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">function bindCaptchaBtnClick()&#123;</span><br><span class="line">    $(&quot;#captcha_btn&quot;).on(&quot;click&quot;,function (event)&#123;</span><br><span class="line">       // 用$包裹表示这个按钮，不包裹等于这个函数</span><br><span class="line">        var $this = $(this)</span><br><span class="line">        // 获取input标签，获取email的值</span><br><span class="line">        var email = $(&quot;input[name=&#x27;email&#x27;]&quot;).val();</span><br><span class="line">        if(!email)&#123;</span><br><span class="line">            alert(&quot;请先输入邮箱！&quot;)</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        //通过Ajax发送网络请求</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:&quot;/user/captcha&quot;,</span><br><span class="line">            method:&quot;POST&quot;,</span><br><span class="line">            data:&#123;</span><br><span class="line">                &quot;email&quot;:email</span><br><span class="line">            &#125;,</span><br><span class="line">            success:function (res)&#123;</span><br><span class="line">                var code = res[&#x27;code&#x27;];</span><br><span class="line">                if(code==200)&#123;</span><br><span class="line">                    //取消点击事件</span><br><span class="line">                    $this.off(&quot;click&quot;);</span><br><span class="line">                    //开始倒计时</span><br><span class="line">                    var countDown = 60;</span><br><span class="line">                    var timer = setInterval(function ()&#123;</span><br><span class="line">                        countDown-=1;</span><br><span class="line">                        if(countDown&gt;0)&#123;</span><br><span class="line">                             $this.text(countDown+&quot;秒后重新发送&quot;);</span><br><span class="line">                        &#125;else&#123;</span><br><span class="line">                            $this.text(&quot;获取验证码&quot;);</span><br><span class="line">                            //重新绑定点击事件;</span><br><span class="line">                            bindCaptchaBtnClick();</span><br><span class="line">                            //清除定时器</span><br><span class="line">                            clearInterval(timer);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;,1000)</span><br><span class="line">                    alert(&quot;验证码发送成功&quot;);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    alert(res[&#x27;message&#x27;]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//等网页所有元素加载完成后执行</span><br><span class="line">$(function ()&#123;</span><br><span class="line">    bindCaptchaBtnClick();</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/11/20220511BS-04/9.png" class title="9.png">


<h4 id="7-登录功能"><a href="#7-登录功能" class="headerlink" title="7.登录功能"></a>7.登录功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@bp.route(&quot;/login&quot;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        return render_template(&quot;login.html&quot;)</span><br><span class="line">    else:</span><br><span class="line">        form = LoginForm(request.form)</span><br><span class="line">        if form.validate():</span><br><span class="line">            email = form.email.data</span><br><span class="line">            password = form.password.data</span><br><span class="line">            user = UserModel.query.filter_by(email=email).first()</span><br><span class="line">            # 解密：check_password_hash(password1,password2)</span><br><span class="line">            if user and check_password_hash(user.password,password):</span><br><span class="line">                # 用户id放session中，便于下一次登录</span><br><span class="line">                session[&#x27;user_id&#x27;] = user.id</span><br><span class="line">                # 登录成功跳转到首页</span><br><span class="line">                return redirect(&quot;/&quot;)</span><br><span class="line">            else:</span><br><span class="line">                flash(&quot;邮箱和密码不匹配！&quot;)</span><br><span class="line">                return redirect(url_for(&quot;user.login&quot;))</span><br><span class="line">        else:</span><br><span class="line">            # 登录失败会登陆页面</span><br><span class="line">            flash(&quot;邮箱或密码格式错误！&quot;)</span><br><span class="line">            return redirect(url_for(&quot;user.login&quot;))</span><br></pre></td></tr></table></figure>


<h4 id="8-退出登录"><a href="#8-退出登录" class="headerlink" title="8.退出登录"></a>8.退出登录</h4><p>同时判断是否登录，未登录则要求先登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># app.py中：</span><br><span class="line"></span><br><span class="line">@app.before_request</span><br><span class="line">def before_request():</span><br><span class="line">    user_id = session.get(&quot;user_id&quot;)</span><br><span class="line">    # 如果session里id存在，用于判断是否有登录，未登录不给操作其他功能</span><br><span class="line">    if user_id:</span><br><span class="line">        try:</span><br><span class="line">            user = UserModel.query.get(user_id)</span><br><span class="line">            # 给g（全局变量）绑定一个叫做user的变量，值为user</span><br><span class="line">            g.user = user</span><br><span class="line">        except:</span><br><span class="line">            g.user = None</span><br><span class="line"></span><br><span class="line"># 一个请求来了，先执行befor_request，再执行视图函数，返回视图函数中模板，最后执行context_processor</span><br><span class="line"></span><br><span class="line">@app.context_processor</span><br><span class="line">def context_processor():</span><br><span class="line">    # hasattr()函数用于判断对象是否包含对应的属性。（对象，属性）</span><br><span class="line">    if hasattr(g,&quot;user&quot;):</span><br><span class="line">        return &#123;&quot;user&quot;:g.user&#125;</span><br><span class="line">    else:</span><br><span class="line">        return &#123;&#125;</span><br><span class="line"></span><br><span class="line"># base.html中更改下：</span><br><span class="line">&#123;% if user %&#125;</span><br><span class="line"></span><br><span class="line">       &lt;li class=&quot;nav-item&quot; &gt;</span><br><span class="line"></span><br><span class="line">          &lt;a class=&quot;nav-link active&quot; &gt;&lt;i class=&quot;bi bi-person-check&quot;&gt;&lt;/i&gt;  &#123;&#123; user.username &#125;&#125;&lt;/a&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line"></span><br><span class="line">          &lt;a class=&quot;nav-link &quot; aria-current=&quot;page&quot; href=&quot;&#123;&#123; url_for(&#x27;user.logout&#x27;) &#125;&#125;&quot; style=&quot;color: #FFFFFF&quot;&gt; 注销&lt;/a&gt;</span><br><span class="line">       &#123;% else %&#125;</span><br><span class="line">            &lt;i class=&quot;bi bi-person&quot; style=&quot;font-size: 25px;color: white&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link &quot; aria-current=&quot;page&quot; href=&quot;&#123;&#123; url_for(&#x27;user.login&#x27;) &#125;&#125;&quot; style=&quot;color: #FFFFFF&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link &quot; aria-current=&quot;page&quot; href=&quot;&#123;&#123; url_for(&#x27;user.register&#x27;) &#125;&#125;&quot; style=&quot;color: #FFFFFF&quot;&gt;注册&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 再写个路由</span><br><span class="line">@bp.route(&quot;/logout&quot;)</span><br><span class="line">def logout():</span><br><span class="line">    session.clear()</span><br><span class="line">    return redirect(url_for(&#x27;user.login&#x27;))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/05/09/20220509BS-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/05/09/20220509BS-03/" class="post-title-link" itemprop="url">毕设：基于机器学习的法律文书自动分类系统设计与实现__03flask基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-09 14:47:21" itemprop="dateCreated datePublished" datetime="2022-05-09T14:47:21+08:00">2022-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-11 09:32:40" itemprop="dateModified" datetime="2022-05-11T09:32:40+08:00">2022-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、Jinja2模板"><a href="#一、Jinja2模板" class="headerlink" title="一、Jinja2模板"></a>一、Jinja2模板</h3><p>Jinja2 是一个现代的，设计者友好的，仿照 Django 模板的 Python 模板语言。它速度快，被广泛使用，并且提供了可选的沙箱模板执行环境保证安全。</p>
<ol>
<li>render_template，渲染模板</li>
</ol>
<ul>
<li><p>在templates文件夹中新建html页面（即模板文件），通过render_template来渲染模板</p>
</li>
<li><p>在app.py中新建路由，url必须以/开头，否则会报错（ValueError: urls must start with a leading slash）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask,render_template</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/about&quot;)</span><br><span class="line">def about():</span><br><span class="line">    return render_template(&quot;about.html&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此时开启服务器，访问<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/about%E5%8D%B3%E5%8F%AF%E5%88%B0%E8%BE%BE%E6%B8%B2%E6%9F%93%E5%AE%8C%E6%AF%95%E7%9A%84html%E9%A1%B5%E9%9D%A2%E3%80%82">http://127.0.0.1:5000/about即可到达渲染完毕的html页面。</a></p>
</li>
<li><p>如果要传递参数，用插值表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#  html中：</span><br><span class="line">&lt;h1&gt;这里是关于页面,&#123;&#123; username &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/about&quot;)</span><br><span class="line">def about():</span><br><span class="line">    context = &#123;</span><br><span class="line">        &quot;username&quot;:&quot;张三&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    #  **context关键字参数</span><br><span class="line">    return render_template(&quot;about.html&quot;,**context)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>控制语句<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ if语句：在模板文件中从 &#123;% %&#125; 写，例如 &#123;% if age &gt; 18 %&#125; ,同时必须要有结束语句&#123;% end if %&#125;。</span><br><span class="line">+ 循环for in ：例如&#123;% for book in books %&#125;,&#123;% end for %&#125;。</span><br></pre></td></tr></table></figure></li>
</ol>
<p>其他可以去看Jinja中文文档<a target="_blank" rel="noopener" href="https://docs.pythontab.com/jinja/jinja2/index.html%EF%BC%8C%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B0%B1%E6%98%AF%E4%BB%A5%E4%B8%8A%E9%83%A8%E5%88%86">https://docs.pythontab.com/jinja/jinja2/index.html，常用的就是以上部分</a></p>
<ol start="3">
<li>模板继承：用于解决重复代码冗余问题</li>
</ol>
<ul>
<li>先定义一个父模板（base.html），然后把子模板要实现的部分抽取出来（相当于开个入口）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&#123;#&#123;% block title %&#125;&#123;% endblock %&#125;规定了子模板的入口#&#125;</span><br><span class="line">  &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;header&gt;我是顶部&lt;/header&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;/&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;/about&quot;&gt;关于&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&#123;#这里是每个子模板各自实现的部分#&#125;</span><br><span class="line">&#123;% block body %&#125;&#123;% endblock %&#125;</span><br><span class="line">&lt;footer&gt;我是底部&lt;/footer&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li>子模板继承父模板，复用父模板的公共部分，实现入口处私有部分，例如：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 关于页面</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;关于&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">    &lt;h1&gt;这是关于&lt;/h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"># 首页</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;首页&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">    &lt;h1&gt;这是首页&lt;/h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>实现效果：</p>
<img src="/GANRDEN010.github.io/2022/05/09/20220509BS-03/1.png" class title="1.png">

<ol start="4">
<li>模板中加载静态文件</li>
</ol>
<p>web应用中会出现大量静态文件使得网页变得更加生动美观，例如css样式文件、JavaScript脚本文件、图片、字体文件等。Jinja2中加载静态文件使用url_for全局函数即可实现。<br>url_for函数默认从根目录下/static文件夹中寻找。</p>
<p>例如：使用bootstrap5UI框架（<a target="_blank" rel="noopener" href="https://v5.bootcss.com/%EF%BC%89%EF%BC%8C%E6%A0%B9%E6%8D%AE%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3%E5%AE%89%E8%A3%85%E5%90%8E%E6%94%BE%E5%9C%A8static%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%EF%BC%8C%E5%BC%95%E5%85%A5">https://v5.bootcss.com/），根据中文文档安装后放在static文件夹中，引入</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;bootstrap5/bootstrap.min.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;bootstrap5/font/bootstrap-icons.css&#x27;) &#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/05/08/20220508BS-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/05/08/20220508BS-02/" class="post-title-link" itemprop="url">毕设：基于机器学习的法律文书自动分类系统设计与实现__02模型搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-08 11:06:23 / 修改时间：21:23:32" itemprop="dateCreated datePublished" datetime="2022-05-08T11:06:23+08:00">2022-05-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、人工智能、机器学习、深度学习之间的关系"><a href="#一、人工智能、机器学习、深度学习之间的关系" class="headerlink" title="一、人工智能、机器学习、深度学习之间的关系"></a>一、人工智能、机器学习、深度学习之间的关系</h3><ul>
<li>1956 年提出 AI 概念，短短3年后（1959） 亚瑟·塞缪尔(Arthur Samuel) 就提出了机器学习的概念：机器学习研究和构建的是一种特殊算法（而非某一个特定的算法），能够让计算机自己在数据中学习从而进行预测。机器学习不是某种具体的算法，而是很多算法的统称。</li>
<li>机器学习包含了很多种不同的算法，深度学习就是其中之一，其他方法包括决策树，聚类，贝叶斯等。</li>
<li>深度学习的灵感来自大脑的结构和功能，即许多神经元的互连。人工神经网络（ANN）是模拟大脑生物结构的算法</li>
<li>不管是机器学习还是深度学习，都属于人工智能（AI）的范畴。</li>
</ul>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/1.png" class title="1.png">

<p> 机器学习的基本思路：</p>
<ul>
<li>把现实生活中的问题抽象成数学模型，并且很清楚模型中不同参数的作用</li>
<li>利用数学方法对这个数学模型进行求解，从而解决现实生活中的问题</li>
<li>评估这个数学模型，是否真正的解决了现实生活中的问题，解决的如何？</li>
</ul>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/2.png" class title="2.png">


<h3 id="二、机器学习分类"><a href="#二、机器学习分类" class="headerlink" title="二、机器学习分类"></a>二、机器学习分类</h3><h5 id="机器学习根据训练方法大致可以分为3大类：监督学习、非监督学习、强化学习"><a href="#机器学习根据训练方法大致可以分为3大类：监督学习、非监督学习、强化学习" class="headerlink" title="机器学习根据训练方法大致可以分为3大类：监督学习、非监督学习、强化学习"></a>机器学习根据训练方法大致可以分为3大类：监督学习、非监督学习、强化学习</h5><ol>
<li>监督学习</li>
</ol>
<blockquote>
<p>监督学习是指我们给算法一个数据集，并且给定正确答案。机器通过数据来学习正确答案的计算方法。</p>
</blockquote>
<p> 例如：我们准备了一大堆猫和狗的照片，我们想让机器学会如何识别猫和狗。当我们使用监督学习的时候，我们需要给这些照片打上标签。我们给照片打的标签就是“正确答案”，机器通过大量学习，就可以学会在新照片中认出猫和狗。这种学习方式效果非常好，但是成本也非常高。</p>
<ol start="2">
<li>非监督学习</li>
</ol>
<blockquote>
<p>非监督学习中，给定的数据集没有“正确答案”，所有的数据都是一样的。无监督学习的任务是从给定的数据集中，挖掘出潜在的结构。</p>
</blockquote>
<p>我们把一堆猫和狗的照片给机器，不给这些照片打任何标签，但是我们希望机器能够将这些照片分分类。通过学习，机器会把这些照片分为2类，一类都是猫的照片，一类都是狗的照片。虽然跟上面的监督学习看上去结果差不多，但是有着本质的差别：<br>非监督学习中，虽然照片分为了猫和狗，但是机器并不知道哪个是猫，哪个是狗。对于机器来说，相当于分成了 A、B 两类。</p>
<ol start="3">
<li>强化学习</li>
</ol>
<p>强化学习更接近生物学习的本质，因此有望获得更高的智能。它关注的是智能体如何在环境中采取一系列行为，从而获得最大的累积回报。通过强化学习，一个智能体应该知道在什么状态下应该采取什么行为。（如==阿尔法狗==）</p>
<h3 id="三-、15种经典机器学习算法"><a href="#三-、15种经典机器学习算法" class="headerlink" title="三 、15种经典机器学习算法"></a>三 、15种经典机器学习算法</h3><table>
<thead>
<tr>
<th>算法</th>
<th>训练方式</th>
</tr>
</thead>
<tbody><tr>
<td>线性回归</td>
<td>监督学习</td>
</tr>
<tr>
<td>逻辑回归</td>
<td>监督学习</td>
</tr>
<tr>
<td>线性判别分析</td>
<td>监督学习</td>
</tr>
<tr>
<td>决策树</td>
<td>监督学习</td>
</tr>
<tr>
<td>朴素贝叶斯</td>
<td>监督学习</td>
</tr>
<tr>
<td>K邻近</td>
<td>监督学习</td>
</tr>
<tr>
<td>学习向量量化</td>
<td>监督学习</td>
</tr>
<tr>
<td>支持向量机</td>
<td>监督学习</td>
</tr>
<tr>
<td>随机森林</td>
<td>监督学习</td>
</tr>
<tr>
<td>AdaBoost</td>
<td>监督学习</td>
</tr>
<tr>
<td>高斯混合模型</td>
<td>非监督学习</td>
</tr>
<tr>
<td>限制波尔兹曼机</td>
<td>非监督学习</td>
</tr>
<tr>
<td>K-means 聚类</td>
<td>非监督学习</td>
</tr>
<tr>
<td>最大期望算法</td>
<td>非监督学习</td>
</tr>
</tbody></table>
<h3 id="四、朴素贝叶斯"><a href="#四、朴素贝叶斯" class="headerlink" title="四、朴素贝叶斯"></a>四、朴素贝叶斯</h3><h4 id="1-贝叶斯公式"><a href="#1-贝叶斯公式" class="headerlink" title="1. 贝叶斯公式"></a>1. 贝叶斯公式</h4><p>贝叶斯主要解决逆向概率问题：</p>
<ul>
<li>正向概率：N个白球M个黑球，摸出白球的概率。</li>
<li>逆向概率：不知道黑白球比例，按摸出的情况逆推。</li>
<li>朴素：假设特征之间相互独立。</li>
</ul>
<p>公式：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/3.png" class title="3.png">

<p>P(A|B)为条件概率，B情况下A发生的概率；P(A)为先验概率。</p>
<h4 id="2-朴素贝叶斯，举个栗子："><a href="#2-朴素贝叶斯，举个栗子：" class="headerlink" title="2. 朴素贝叶斯，举个栗子："></a>2. 朴素贝叶斯，举个栗子：</h4><p>有两个类别T1、T2，特征为A、B、C。现在去预测A3B3C3的类别：</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>Tag</th>
</tr>
</thead>
<tbody><tr>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>T1</td>
</tr>
<tr>
<td>A1</td>
<td>B2</td>
<td>C1</td>
<td>T2</td>
</tr>
<tr>
<td>A1</td>
<td>B1</td>
<td>C2</td>
<td>T1</td>
</tr>
<tr>
<td>A1</td>
<td>B1</td>
<td>C3</td>
<td>T2</td>
</tr>
<tr>
<td>A2</td>
<td>B3</td>
<td>C1</td>
<td>T1</td>
</tr>
<tr>
<td>A3</td>
<td>B1</td>
<td>C1</td>
<td>T2</td>
</tr>
</tbody></table>
<p>此时带入贝叶斯公式：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/4.png" class title="4.png">

<p>假设特征相互独立（朴素）：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/5.png" class title="5.png">

<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/6.png" class title="6.png">

<p>此时各项概率都能由图表得出，P(T2|A3B3C3)的概率同理，谁的概率高就属于哪一类。</p>
<h3 id="二、-KNN-K-Near-Neighbor"><a href="#二、-KNN-K-Near-Neighbor" class="headerlink" title="二、 KNN(K Near Neighbor)"></a>二、 KNN(K Near Neighbor)</h3><ul>
<li>k个最近的邻居，即每个样本都可以用它最接近的k个邻居来代表。一个样本与数据集中的k个样本最相似，如果这k个样本中的大多数属于某一个类别， 则该样本也属于这个类别。</li>
<li>最简单的KNN就是X附近找K个训练元素，哪类多属于哪类。 </li>
</ul>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/7.png" class title="7.png">

<ul>
<li>K值的选取和点距离的计算</li>
</ul>
<ol>
<li>距离计算</li>
</ol>
<p>要度量空间中点距离的话，有好几种度量方式，比如常见的曼哈顿距离计算，欧式距离计算等等。不过通常KNN算法中使用的是欧式距离，这里只是简单说一下，拿二维平面为例，二维空间两个点的欧式距离计算公式如下：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/8.png" class title="8.png">

<p>2.K值选取</p>
<p>通过交叉验证（将样本数据按照一定比例，拆分出训练用的数据和验证用的数据，比如8:2拆分出部分训练数据和验证数据），从选取一个较小的K值开始，不断增加K的值，然后计算验证集合的方差，最终找到一个比较合适的K值。</p>
<p>当你增大k的时候，一般错误率会先降低，因为有周围更多的样本可以借鉴了，分类效果会变好。但注意，当K值更大的时候，错误率会更高。这也很好理解，比如说你一共就35个样本，当你K增大到30的时候，KNN基本上就没意义了。</p>
<h3 id="五、-代码实现（通过sklearn库）"><a href="#五、-代码实现（通过sklearn库）" class="headerlink" title="五、 代码实现（通过sklearn库）"></a>五、 代码实现（通过sklearn库）</h3><h4 id="1-朴素贝叶斯"><a href="#1-朴素贝叶斯" class="headerlink" title="1. 朴素贝叶斯"></a>1. 朴素贝叶斯</h4><p>（1）流程</p>
<p>数据预处理——切分数据集——保存模型数据——特征工程——创建预估器——模型评估</p>
<p>（2）数据切分，保存模型数据</p>
<blockquote>
<p>经过测试，模型花费的主要时间是在分词、去停用词部分，pickle本质是保存一个变量的当前状态，故可以通过保存数据预处理后的数据状态来节约时间。</p>
</blockquote>
<p>切分数据：sklearn库中提供train_test_split()方法，这里按照8:2来切分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line"></span><br><span class="line"># x_train1,x_test1:训练集和测试集data   ;   y_train, y_test:对应的类别target,  训练集:测试集=8:2    都是list</span><br><span class="line">x_train1, x_test1, y_train, y_test = train_test_split(data, target, test_size=0.2)</span><br></pre></td></tr></table></figure>

<p>模型数据保存：利用pickle模块进行保存（pip install pickle）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">    def nb_data(self,data,target):</span><br><span class="line">        # 1.切分数据</span><br><span class="line">        # x_train1,x_test1:训练集和测试集data   ;   y_train, y_test:对应的类别target,  训练集:测试集=8:2    都是list</span><br><span class="line">        x_train1, x_test1, y_train, y_test = train_test_split(data, target, test_size=0.2)</span><br><span class="line">        # 放列表里</span><br><span class="line">        x_train = []</span><br><span class="line">        x_test = []</span><br><span class="line">        for i in x_train1:</span><br><span class="line">            str = &quot; &quot;.join(i)</span><br><span class="line">            x_train.append(str)</span><br><span class="line">        for i in x_test1:</span><br><span class="line">            str = &quot; &quot;.join(i)</span><br><span class="line">            x_test.append(str)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;X_train.pkl&#x27;, &#x27;wb&#x27;) as f:</span><br><span class="line">            pickle.dump(x_train, f)</span><br><span class="line">        with open(&#x27;X_test.pkl&#x27;, &#x27;wb&#x27;) as f:</span><br><span class="line">            pickle.dump(x_test, f)</span><br><span class="line">        with open(&#x27;Y_train.pkl&#x27;, &#x27;wb&#x27;) as f:</span><br><span class="line">            pickle.dump(y_train, f)</span><br><span class="line">        with open(&#x27;Y_test.pkl&#x27;, &#x27;wb&#x27;) as f:</span><br><span class="line">            pickle.dump(y_test, f)</span><br><span class="line">            print(&quot;保存成功！&quot;)</span><br></pre></td></tr></table></figure>

<p>（3） 特征工程、模型评估</p>
<ul>
<li>特征抽取<br>一篇文章在经过了分词处理之后,会产生很多词条。如果一个文档所有词条都被作为其特征,将会使特征项异常庞大,而且这样的特征项会使得每个特征项所含信息非常平滑,有用信息反而不会突出。因此我们需要进行特征项选取,把词条中最能代表某类文本信息的词条挑选出来,作为文本的特征项。 </li>
<li>TF-IDF：<br>TF-IDF是一种统计方法，用以评估一字词对于一个文件集或一个语料库中的其中一份文件的重要程度。字词的重要性随着它在文件中出现的次数成正比增加，但同时会随着它在语料库中出现的频率成反比下降。其主要思想是：如果某个单词在一篇文章中出现的频率TF高，并且在其他文章中很少出现，则认为此词或者短语具有很好的类别区分能力，适合用来分类。</li>
<li> 特征预处理：归一化、标准化</li>
</ul>
<ol>
<li>归一化：<br>把数据变成（0,1）或者（1,1）之间的小数。主要是为了数据处理方便提出来的，把数据映射到0～1范围之内处理，更加便捷快速。把有量纲表达式变成无量纲表达式，便于不同单位或量级的指标能够进行比较和加权。归一化是一种简化计算的方式，即将有量纲的表达式，经过变换，化为无量纲的表达式，成为纯量。</li>
<li>标准化：<br>标准化是依照特征矩阵的列处理数据。数据标准化方法有多种，如：直线型方法(如极值法、标准差法)、折线型方法(如三折线法)、曲线型方法(如半正态性分布)。不同的标准化方法，对系统的评价结果会产生不同的影响。其中，最常用的是Z-Score 标准化。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.feature_extraction.text import TfidfVectorizer</span><br><span class="line">from sklearn.naive_bayes import MultinomialNB</span><br><span class="line"></span><br><span class="line">    def nb_modle(self):</span><br><span class="line">        with open(&#x27;X_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;X_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            x_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;Y_train.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_train = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        with open(&#x27;Y_test.pkl&#x27;, &#x27;rb&#x27;) as file:</span><br><span class="line">            y_test = pickle.load(file)</span><br><span class="line"></span><br><span class="line">        # 2.特征工程：文本特征抽取TF-IDF</span><br><span class="line">        transfer = TfidfVectorizer()</span><br><span class="line">        x_train = transfer.fit_transform(x_train)</span><br><span class="line">        # x_train的type-&gt; scipy.sparse.csr.csr_matrix,不可输出</span><br><span class="line">        x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">        # 3.朴素贝叶斯算法预估器流程</span><br><span class="line">        estimator = MultinomialNB()</span><br><span class="line">        estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">        # 4.模型评估</span><br><span class="line">        predict = estimator.predict(x_test)</span><br><span class="line">        # 计算准确率</span><br><span class="line">        score = estimator.score(x_test,y_test)</span><br><span class="line">        print(&quot;朴素贝叶斯检测：&quot;)</span><br><span class="line">        print(&quot;predic:\n&quot;, predict)</span><br><span class="line">        print(&quot;真实值和预测值比较：\n&quot;, y_test == predict)</span><br><span class="line">        print(&quot;准确率：\n&quot;, score)</span><br><span class="line"></span><br><span class="line">        return predict,y_test == predict,score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 测试类</span><br><span class="line">from NaiveBayes import NaiveBayes</span><br><span class="line"></span><br><span class="line"># NaiveBayes预测结果</span><br><span class="line">nb1 = NaiveBayes()</span><br><span class="line">predict,res,score = nb1.nb_modle()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>结果展示：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/9.png" class title="9.png">



<h4 id="2-KNN"><a href="#2-KNN" class="headerlink" title="2. KNN"></a>2. KNN</h4><p>因为使用相同数据集，所以使用已保存的pkl文件就行，把朴素贝叶斯换成KNN（作为懒狗，还是用sklearn库中的方法）,差别就是预估器变了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.neighbors import KNeighborsClassifier</span><br><span class="line">    #其余和贝叶斯相同</span><br><span class="line">    estimator = KNeighborsClassifier()</span><br></pre></td></tr></table></figure>


<p>结果展示：</p>
<img src="/GANRDEN010.github.io/2022/05/08/20220508BS-02/10.png" class title="10.png">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://garden010.github.io/GANRDEN010.github.io/2022/05/05/20220505BS-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/GANRDEN010.github.io/images/avatar.gif">
      <meta itemprop="name" content="Garden">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garden">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/GANRDEN010.github.io/2022/05/05/20220505BS-01/" class="post-title-link" itemprop="url">毕设：基于机器学习的法律文书自动分类系统设计与实现__01数据预处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-05 15:32:53" itemprop="dateCreated datePublished" datetime="2022-05-05T15:32:53+08:00">2022-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-06 11:15:04" itemprop="dateModified" datetime="2022-05-06T11:15:04+08:00">2022-05-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、flask框架"><a href="#一、flask框架" class="headerlink" title="一、flask框架"></a>一、flask框架</h3><blockquote>
<p>flask框架是python中的一个轻量级的前后端开发框架，不同于Django，flask只提供基础的功能，其他的功能需要安装各种插件。</p>
</blockquote>
<p>官方文档：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://dormousehole.readthedocs.io/en/latest/">https://dormousehole.readthedocs.io/en/latest/</a></p>
</blockquote>
<p>知了文档</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zlkt.net/book/detail/10">https://www.zlkt.net/book/detail/10</a></p>
</blockquote>
<h5 id="安装flask"><a href="#安装flask" class="headerlink" title="安装flask"></a>安装flask</h5><blockquote>
<p>cmd: pip install flask </p>
</blockquote>
<h5 id="新建flask项目"><a href="#新建flask项目" class="headerlink" title="新建flask项目"></a>新建flask项目</h5><p>社区版pycharm有预设，更简单。</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/1.png" class title="1.png">
<p>运行环境调整至对应编译器版本，点击运行，进入首页。</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/2.png" class title="2.png">
<p>首页对应根路径下hello_world()方法</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/3.png" class title="3.png">


<h3 id="二、设计模型"><a href="#二、设计模型" class="headerlink" title="二、设计模型"></a>二、设计模型</h3><p>根目录下新建文件夹放模型：NLP_Modle</p>
<h4 id="1-通过scrapy框架爬到的数据集："><a href="#1-通过scrapy框架爬到的数据集：" class="headerlink" title="1. 通过scrapy框架爬到的数据集："></a>1. 通过scrapy框架爬到的数据集：</h4><blockquote>
<p>data分为民事、刑事、行政三类，为了节约时间提取部分数据作为Test.json</p>
</blockquote>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/4.png" class title="4.png">

<h4 id="2-设置停用词字典和自定义词典："><a href="#2-设置停用词字典和自定义词典：" class="headerlink" title="2. 设置停用词字典和自定义词典："></a>2. 设置停用词字典和自定义词典：</h4><blockquote>
<p>停用词：停用词是指在信息检索中，为节省存储空间和提高搜索效率，在处理自然语言数据（或文本）之前或之后会自动过滤掉某些字或词。（比如你我他这类没有特征意义的字词）</p>
</blockquote>
<blockquote>
<p>自定义字典：如“中华人民共和国民事诉讼法”这个词经过分词可能分为“中华人民共和国、民事、诉讼法”三个词，与预期不符，这时就可以通过设置自定义字典令字典中的词组不会分成多个词语</p>
</blockquote>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/5.png" class title="5.png">

<h4 id="3-数据预处理"><a href="#3-数据预处理" class="headerlink" title="3. 数据预处理"></a>3. 数据预处理</h4><h5 id="（1）-Data-Pre-get-data-self-fp-，获取数据"><a href="#（1）-Data-Pre-get-data-self-fp-，获取数据" class="headerlink" title="（1）. Data_Pre().get_data(self,fp)，获取数据"></a>（1）. Data_Pre().get_data(self,fp)，获取数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">    # 获取数据</span><br><span class="line">    def get_data(self,fp):</span><br><span class="line">        f2 = open(fp, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">        info_data = json.load(f2)</span><br><span class="line">        list_data = []</span><br><span class="line">        for i in info_data:</span><br><span class="line">            # title和content拼接在一起</span><br><span class="line">            list_data.append(i[&#x27;title&#x27;] + i[&#x27;content&#x27;])</span><br><span class="line">        f2.close()</span><br><span class="line">        return list_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 测试：</span><br><span class="line">    from Data_Pre import Data_Pre</span><br><span class="line"></span><br><span class="line">class Test():</span><br><span class="line">    min_shi = Data_Pre()</span><br><span class="line">    min_shi_list = min_shi.get_data(r&#x27;E:\Java_workspace\final_flask_20220505\NLP_Modle\data\test.json&#x27;)</span><br><span class="line">    print(len(min_shi_list))</span><br><span class="line">    print(type(min_shi_list))</span><br><span class="line">    print(min_shi_list)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/6.png" class title="6.png">

<h5 id="（2）-Data-Pre-pre-word-self-data-，去停用词等"><a href="#（2）-Data-Pre-pre-word-self-data-，去停用词等" class="headerlink" title="（2）. Data_Pre().pre_word(self,data)，去停用词等"></a>（2）. Data_Pre().pre_word(self,data)，去停用词等</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    def pre_word(self,data):</span><br><span class="line">        jieba.load_userdict(r&quot;E:\Java_workspace\final_flask_20220505\NLP_Modle\dict\dict.txt&quot;)  # 加载自定义词典</span><br><span class="line">        stopwords = [line.strip() for line in open</span><br><span class="line">        (r&#x27;E:\Java_workspace\final_flask_20220505\NLP_Modle\dict\cn_stopwords.txt&#x27;, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">            .readlines()]  # 加载停用词列表</span><br><span class="line">        # 1.分词</span><br><span class="line">        data2 = []</span><br><span class="line">        for sentence in data:</span><br><span class="line">            data2.append(jieba.cut(sentence))</span><br><span class="line">        # 2.去停用词</span><br><span class="line">        data3 = []</span><br><span class="line">        for word_generator in data2:</span><br><span class="line">            word_list = []</span><br><span class="line">            for word in word_generator:</span><br><span class="line">                if len(word) != 1 and word not in stopwords and word.isdigit() == False:  # 去单字、停用词和数字</span><br><span class="line">                    word_list.append(word)</span><br><span class="line">            data3.append(word_list)</span><br><span class="line">        return data3</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">class Test():</span><br><span class="line">    # 获取数据</span><br><span class="line">    min_shi = Data_Pre()</span><br><span class="line">    min_shi_list = min_shi.get_data(r&#x27;E:\Java_workspace\final_flask_20220505\NLP_Modle\data\test.json&#x27;)</span><br><span class="line"></span><br><span class="line">    # 分词去停用词</span><br><span class="line">    min_shi_wordList = min_shi.pre_word(min_shi_list)</span><br><span class="line">    print(min_shi_wordList)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/7.png" class title="7.png">

<h5 id="（3）-Data-Pre-word-frequency-self-data-，统计词频并做降序排列————为词云做准备"><a href="#（3）-Data-Pre-word-frequency-self-data-，统计词频并做降序排列————为词云做准备" class="headerlink" title="（3）. Data_Pre().word_frequency(self,data)，统计词频并做降序排列————为词云做准备"></a>（3）. Data_Pre().word_frequency(self,data)，统计词频并做降序排列————为词云做准备</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> # 3.统计词频(整个训练集样本)</span><br><span class="line">    def word_frequency(self,data):</span><br><span class="line">        counts=&#123;&#125;</span><br><span class="line">        for word_list in data:</span><br><span class="line">            for word in word_list:</span><br><span class="line">                counts[word] = counts.get(word, 0) + 1</span><br><span class="line"></span><br><span class="line">        word_frq_list = list(counts.items())  # 字典转元组，元组存放在word_frq_list这个列表里</span><br><span class="line">        word_frq_list.sort(key=lambda x: x[1], reverse=True)    #reverse=True:降序排列</span><br><span class="line">        print(&quot;统计词频完成！&quot;)</span><br><span class="line">        return word_frq_list</span><br><span class="line"></span><br><span class="line">class Test():</span><br><span class="line">    # 获取数据</span><br><span class="line">    min_shi = Data_Pre()</span><br><span class="line">    min_shi_list = min_shi.get_data(r&#x27;E:\Java_workspace\final_flask_20220505\NLP_Modle\data\test.json&#x27;)</span><br><span class="line"></span><br><span class="line">    # 分词去停用词</span><br><span class="line">    min_shi_wordList = min_shi.pre_word(min_shi_list)</span><br><span class="line"></span><br><span class="line">    # 词频统计</span><br><span class="line">    word_frq_list = min_shi.word_frequency(min_shi_wordList)</span><br><span class="line">    print(word_frq_list)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<img src="/GANRDEN010.github.io/2022/05/05/20220505BS-01/8.png" class title="8.png">
<p>在补充一个写入csv文件，方便后面调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def write_to_CSVfp(self,data,fpName):</span><br><span class="line">    f = open(fpName, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;, newline=&#x27;&#x27;)</span><br><span class="line">    # 2. 基于文件对象构建 csv写入对象</span><br><span class="line">    csv_writer = csv.writer(f)</span><br><span class="line">    csv_writer.writerow([&#x27;word&#x27;, &#x27;Frequency&#x27;])</span><br><span class="line">    for i in data:</span><br><span class="line">        csv_writer.writerow(i)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<h5 id="（3）-Data-Pre-target-self-lenth-target-给训练集加上类别"><a href="#（3）-Data-Pre-target-self-lenth-target-给训练集加上类别" class="headerlink" title="（3）. Data_Pre().target(self,lenth,target) :给训练集加上类别"></a>（3）. Data_Pre().target(self,lenth,target) :给训练集加上类别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def target(self,lenth,target):</span><br><span class="line">    targetlist=[]</span><br><span class="line">    for i in range(lenth):</span><br><span class="line">        targetlist.append(target)</span><br><span class="line">    return targetlist</span><br><span class="line"></span><br><span class="line">class Test():</span><br><span class="line"># 获取数据</span><br><span class="line">min_shi = Data_Pre()</span><br><span class="line">min_shi_list = min_shi.get_data(r&#x27;E:\Java_workspace\final_flask_20220505\NLP_Modle\data\test.json&#x27;)</span><br><span class="line"></span><br><span class="line"># 分词去停用词</span><br><span class="line">min_shi_wordList = min_shi.pre_word(min_shi_list)</span><br><span class="line"></span><br><span class="line"># 加类别</span><br><span class="line">target = min_shi.target(len(min_shi_wordList),&quot;test&quot;)</span><br><span class="line">print(target)</span><br><span class="line">print(len(min_shi_wordList))</span><br></pre></td></tr></table></figure>
<p>target列表和用于测试的min_shi_wordList列表长度一致，用于标志该训练集类别</p>
<h5 id="（3）-SumData-sum-data-self-data1-data2-data3-合并加完类别的数据集"><a href="#（3）-SumData-sum-data-self-data1-data2-data3-合并加完类别的数据集" class="headerlink" title="（3）. SumData().sum_data(self,data1,data2,data3) :合并加完类别的数据集"></a>（3）. SumData().sum_data(self,data1,data2,data3) :合并加完类别的数据集</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class SumData():</span><br><span class="line">    def sum_data(self,data1,data2,data3):</span><br><span class="line">        data=data1+data2+data3</span><br><span class="line">        return data</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">s1=SumData()</span><br><span class="line">    data = s1.sum_data(min_shi,xin_shi,xing_zheng)</span><br><span class="line">    target = s1.sum_data(target_1,target_2,target_3)</span><br></pre></td></tr></table></figure>


<h3 id="至此，数据预处理基本完成，接下来就是模型的训练。"><a href="#至此，数据预处理基本完成，接下来就是模型的训练。" class="headerlink" title="至此，数据预处理基本完成，接下来就是模型的训练。"></a>至此，数据预处理基本完成，接下来就是模型的训练。</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/GANRDEN010.github.io/page/2/">2</a><a class="extend next" rel="next" href="/GANRDEN010.github.io/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Garden</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/GANRDEN010.github.io/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Garden</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/GANRDEN010.github.io/lib/anime.min.js"></script>
  <script src="/GANRDEN010.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/GANRDEN010.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/GANRDEN010.github.io/js/utils.js"></script>

<script src="/GANRDEN010.github.io/js/motion.js"></script>


<script src="/GANRDEN010.github.io/js/schemes/pisces.js"></script>


<script src="/GANRDEN010.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
